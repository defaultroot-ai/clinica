## Plan de lucru – 12.09.2025

### Obiective principale
- **Dashboard Asistent**: listă programări cu acțiuni rapide; filtre; căutare; paginare; actualizări live.
- **Dashboard Recepție**: aceleași capabilități ca Asistent + creare rapidă programare; verificare sloturi; preluare apeluri (UI minimal).
- **Actualizări live**: sincronizare status în dashboard-uri când se schimbă programările (confirmat/completat/anulat/no_show).
- **Verificare temeinică plugin**: audit fluxuri, cron, permisiuni, consistență statusuri, UI/UX, performanță.

### Livrabile
- **Asistent**: pagină dashboard funcțională în `wp-admin` cu listă programări, filtre, acțiuni rapide și refresh live.
- **Recepție**: pagină dashboard funcțională cu aceleași capabilități + „Programare nouă” asistată.
- **Infra live updates**: endpoint(‑uri) + logică client pentru actualizări fără reîncărcarea paginii.
- **Raport QA**: checklist bifat și observații în `docs/raport-verificare.md` (sau similar).

### Specificații funcționale (rezumat)
- **Listare programări**: coloane pacient, doctor, dată, interval, durată, serviciu, status, creat/ed. de; sortare, filtrare după status/doctor/zi; paginare.
- **Acțiuni rapide**:
  - Confirmă / Anulează / Marchează no_show (unde are sens pentru rol).
  - „Vezi” detalii; „Editează” doar dacă statusul permite (nu pentru `completed`).
- **Reguli status**: păstrează `cancelled` dacă data/ora nu se schimbă; viitor = `confirmed`; trecut + 30min după sfârșit = `completed`.
- **Permisiuni**:
  - Asistent: vizualizare + acțiuni rapide pe programări, fără drepturi de administrare globală.
  - Recepție: idem Asistent + creare programare.

### Actualizări live – abordare tehnică
- **Endpoint digest**: `wp_ajax_clinica_appointments_digest` (și varianta `nopriv` dacă va fi necesar), care întoarce un hash/digest pentru filtrul curent (ex: `md5(max(updated_at), count(*))`).
- **Endpoint listă schimbări**: `wp_ajax_clinica_appointments_changes` cu parametri (filtre, `since_ts`) pentru a prelua doar modificările.
- **Client**: polling la 10–15 sec. (fallback sigur și fără dependințe externe). Dacă digest diferă, cere schimbările și actualizează tabelul incremental.
- **Optimizări**: folosește câmpurile existente `updated_at`, `last_edited_by_*`; index pe `(appointment_date, doctor_id, status)` dacă e necesar pentru performanță.
- (Opțional) hook‑uri la schimbări: la update/anulare să setăm un transient/flag pentru invalidare rapidă.

### Pași de implementare
1) **Schelet pagini**: rute admin, capabilități, layout comun (Asistent/Recepție).
2) **Listă programări + filtre**: interogări eficiente, paginare server‑side; UI curat, profesional.
3) **Acțiuni rapide**: butoane cu nonces; respectă regulile status; mesaje de confirmare.
4) **Actualizări live**: implementează digest + polling; actualizare incrementală a rândurilor (minim flicker).
5) **Recepție – creare rapidă**: formular compact, validări, verificare sloturi curente (fără sloturi trecute azi).
6) **QA și reglaje**: teste edge‑cases, timezone, permisiuni, cache browser.

### Teste/QA (checklist)
- **Statusuri**: confirm→completed (+30min după sfârșit) doar pentru `confirmed`; păstrare `cancelled` dacă nu se schimbă ora/data la editare; editarea blocată pentru `completed`.
- **UI**: butoane conforme (fără gradient), culori status text; lățime consistentă cu doctor dashboard; fără flash la încărcare.
- **Sloturi azi**: nu arată și nu permite sloturi trecute; permite ziua curentă dacă există sloturi viitoare.
- **Permisiuni**: acces conform rol (asistent/recepție/doctor/manager/admin/pacient).
- **Cron**: evenimentul `clinica_auto_update_appointment_status` programat la 5 min; test manual.
- **Performanță**: paginare ok; polling nu supraîncarcă; SQL cu indexuri potrivite; fără N+1 vizibile.
- **Securitate**: nonces pentru toate acțiunile, sanitizare/escape; capacități mapate corect.

### Estimare timp (orientativ)
- Schelet + listă + filtre: 3–4h
- Acțiuni rapide + reguli status: 2–3h
- Live updates (endpoint + client): 2–3h
- Recepție (creare rapidă): 2h
- QA & fixuri: 1–2h

### Riscuri / atenționări
- Deplasări de fus orar (server vs WordPress) la calculul pragului +30 min.
- Cache CSS/JS în browser; necesar versioning la asset‑uri.
- Coliziuni concurente (două terminale schimbă același rând); rezolvare prin `updated_at` și re‑fetch.

### Note
- UI rămâne simplu, profesional, fără efecte inutile; iconografie Font Awesome existentă (fără FA6).
- Toate datele și orele afișate în format românesc unde are sens.


